{% load static %}
{% block content %}
<!-- DataTables CSS and JS -->
<title>Manage List</title>
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

<!-- DataTables Buttons extension CSS and JS -->
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css">
<script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>

<div class="">
    <h1>Manage List</h1>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        var code = prompt("Enter key code:");
        if (code !== "0987654321") {
            document.body.style.display = "none"; // Hide the body content
            alert("You don't have access to this page. Redirecting in 5 seconds...");
            setTimeout(function() {
                window.location.href = "https://againandafresh.org"; // Redirect URL
            }, 2000); // Redirect after 2 seconds (2,000 ms)
        }
    </script>

    <h2>Registrants</h2>
    <table id="registrantsTable" class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Phone Number</th>
                <th>Address</th>
                <th>State</th>
                <th>Country</th>
                <th>Accommodation</th>
                <th>Marital Status</th>
                <th>Volunteer</th>
            </tr>
        </thead>
        <tbody>
            {% for registrant in registrants %}
            <tr>
                <td>{{ registrant.first_name }}</td>
                <td>{{ registrant.last_name }}</td>
                <td>{{ registrant.email }}</td>
                <td>{{ registrant.phone_number }}</td>
                <td>{{ registrant.address }}</td>
                <td>{{ registrant.state }}</td>
                <td>{{ registrant.country }}</td>
                <td>{{ registrant.accommodation }}</td>
                <td>{{ registrant.marital_status }}</td>
                <td>
                    {% if not registrant.volunteer %}
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="registrant_id" value="{{ registrant.id }}">
                        <button type="submit" class="btn btn-success">Volunteer</button>
                    </form>
                    {% else %}
                    <span class=" text-info ">Already a Volunteer</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Volunteers</h2>
    <table id="volunteersTable" class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>Phone Number</th>
                <th>Address</th>
                <th>State</th>
                <th>Country</th>
                <th>Accommodation</th>
                <th>Marital Status</th>
            </tr>
        </thead>
        <tbody>
            {% for volunteer in volunteers %}
            <tr>
                <td>{{ volunteer.registrant.first_name }}</td>
                <td>{{ volunteer.registrant.last_name }}</td>
                <td>{{ volunteer.registrant.email }}</td>
                <td>{{ volunteer.registrant.phone_number }}</td>
                <td>{{ volunteer.registrant.address }}</td>
                <td>{{ volunteer.registrant.state }}</td>
                <td>{{ volunteer.registrant.country }}</td>
                <td>{{ volunteer.registrant.accommodation }}</td>
                <td>{{ volunteer.registrant.marital_status }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function () {
            // Initialize DataTable for Registrants Table
            $('#registrantsTable').DataTable({
                "pageLength": 10,
                "searching": true,
                "ordering": true,
                "lengthChange": true,
                "dom": 'Bfrtip',
                "buttons": [
                    'print',
                    'csv',
                    'excel',
                    'pdf'
                ]
            });

            // Initialize DataTable for Volunteers Table
            $('#volunteersTable').DataTable({
                "pageLength": 10,
                "searching": true,
                "ordering": true,
                "lengthChange": true,
                "dom": 'Bfrtip',
                "buttons": [
                    'print',
                    'csv',
                    'excel',
                    'pdf'
                ]
            });
        });
    </script>
</div>

{% if message %}
<div class="alert alert-success">
    {{ message }}
</div>
{% endif %}

{% endblock %}
